<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>로그인</title>
</head>
<body>
  <h2>로그인 / 회원가입</h2>

  <input id="email" placeholder="이메일"><br>
  <input id="password" type="password" placeholder="비밀번호"><br>
  <input id="username" placeholder="닉네임 (회원가입 시)"><br>

  <button id="signupBtn">회원가입</button>
  <button id="loginBtn">로그인</button>
  <p id="error"></p>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-auth.js";
    import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCi0cus6PFFospMymbmILW7jHFu3OBoABY",
      authDomain: "chatchat-98586.firebaseapp.com",
      databaseURL: "https://chatchat-98586-default-rtdb.firebaseio.com",
      projectId: "chatchat-98586",
      storageBucket: "chatchat-98586.firebasestorage.app",
      messagingSenderId: "112409356117",
      appId: "1:112409356117:web:b0c92c82a863ad989371dc"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app);

    signupBtn.onclick = async () => {
      try {
        const cred = await createUserWithEmailAndPassword(auth, email.value, password.value);
        await set(ref(db, "users/" + cred.user.uid), {
          username: username.value,
          createdAt: Date.now()
        });
        location.href = "index.html";
      } catch (e) {
        error.textContent = e.message;
      }
    };

    loginBtn.onclick = async () => {
      try {
        await signInWithEmailAndPassword(auth, email.value, password.value);
        location.href = "index.html";
      } catch (e) {
        error.textContent = e.message;
      }
    };
  </script>
</body>
</html>
